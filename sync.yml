---

- name: Pull latest /etc files on all servers
  hosts: shell-servers
  sudo: yes
  tasks:
  - command: etckeeper vcs pull --ff-only
  - command: etckeeper init

- name: Update/Sync system packages across all servers
  hosts: shell-servers
  sudo: yes
  tasks:
  - apt: update_cache=yes
  - shell: dselect update
  - shell: dpkg --clear-selections
  - shell: dpkg --set-selections < /etc/packages.txt
  - shell: apt-get dselect-upgrade -qy
    environment:
      DEBIAN_FRONTEND: noninteractive
  - apt: upgrade=dist
  - shell: aptitude purge -y -q ~c
    environment:
      DEBIAN_FRONTEND: noninteractive

- name: update #! python packages to all servers
  hosts: shell-servers
  sudo: yes
  tasks:
  - pip: name='git+https://github.com/hashbang/provisor/#egg=provisor'
  - pip: name='git+https://github.com/hashbang/hashbangctl/#egg=hashbangctl'
